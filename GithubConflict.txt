This is the code from the other branch.